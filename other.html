<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VKontakte</title>
    <script
            src="http://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <!-- vKontakte SDK => https://vk.com/dev/widget_auth -->
    <script src="//userapi.com/js/api/openapi.js" type="text/javascript" charset="windows-1251"></script>
    <!-- END -->
</head>
<body>
<!-- vKontakte init -->
<script type="text/javascript">
    VK.init({
        apiId: 6142437
    });
</script>
<!-- END vKontakte init -->
<script>
    var rawHash = window.location.hash.substr(1);
    var rawSearch = window.location.search.substr(1);

    var hash = rawHash.split('&').reduce(function (result, item) {
        var parts = item.split('=');
        result[parts[0]] = parts[1];
        return result;
    }, {});

    var search = rawSearch.split('&').reduce(function (result, item) {
        var parts = item.split('=');
        result[parts[0]] = parts[1];
        return result;
    }, {});

    VK.api('photos.getWallUploadServer', {
        uid: hash.user_id,
        access_token: hash.access_token
    }, function (data) {
        if (data.response) {
            $.post('/upload/', {  // url на ВАШЕМ сервере, который будет загружать изображение на сервер контакта (upload_url)
                upload_url: data.response.upload_url,
                image: image,
            }, function (json) {
                VK.api("photos.saveWallPhoto", {
                    server: json.server,
                    photo: json.photo,
                    hash: json.hash,
                    uid: user_id
                }, function (data) {
                    VK.api('wall.post', {
                        message: message,
                        attachments: data.response['0'].id
                    });
                });
            }, 'json');
        }
    });
</script>
</body>
</html>